- name: Konfiguracja aplikacji na różnych środowiskach
  hosts: all
  gather_facts: false

  tasks:
    # --- 1. Zadanie Konfiguracyjne ---
    - name: Konfiguracja bazowa (zależna od środowiska)
      debug:
        msg: "Konfiguruję {{ env_name }} (Debug: {{ debug_mode }}, Security: {{ security_level }}, Optymalizacja: {{ optimization_level }})"
      tags:
        - config
        # USUNIĘTO PROBLEM: - "{{ env_name }}"

    # --- 2. Zadanie Specjalne ---
    - name: Zadanie uruchamiane tylko dla 'dev'
      debug:
        msg: "TO ZADANIE JEST TYLKO DLA ŚRODOWISKA DEVELOPMENT"
      when: env_name == 'development'
      tags:
        - special

    # --- 3. Testy (assert) ---
    - name: TEST - Weryfikacja poziomu zabezpieczeń
      assert:
        that:
          - security_level != 'low'
        fail_msg: "TEST NIEZALICZONY: Zabezpieczenia są zbyt niskie dla tego środowiska ({{ env_name }})!"
        success_msg: "TEST ZALICZONY: Zabezpieczenia są odpowiednie."
      when: env_name != 'development'
      tags:
        - test
